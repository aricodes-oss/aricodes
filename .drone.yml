kind: pipeline
type: docker
name: publish

platform:
  os: linux
  arch: arm64

steps:
  - name: submodules
    image: alpine/git
    commands:
      - git submodule update --init --recursive

  - name: publish
    image: ubuntu
    commands:
      - apt-get update
      - apt-get install -y hugo rsync
      - hugo
      - echo $PRIVATE_KEY >> id_rsa
      - cd public
      - rsync -avz -e 'ssh -i ../id_rsa -o StrictHostKeyChecking=no' --progress ./* root@aricodes.net:/opt/aricodes/
    environment:
      PRIVATE_KEY:
        from_secret: PRIVATE_KEY
